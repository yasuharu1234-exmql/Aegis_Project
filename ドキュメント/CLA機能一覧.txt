
---

CLA機能一覧 統合版

CLA（Configurable Logic Architecture）システム
全機能リスト - Claude提出版


---

■ この機能一覧の目的

本機能一覧の目的は、システムを「勝たせる」ことではなく、**「壊れずに生き残らせる」**ことにある。

「負けなければ、勝ったも同然」——
損失を防ぐことを最優先とし、利益はその結果として得る。

市場は常に不完全であり、プラットフォームは不安定であり、ロジックは必ず想定外を踏む。

よって本設計では、

勝つこと

高度であること

網羅的であること


よりも先に、

> 壊れる前に止まり、壊れた理由を後から必ず説明できること



を最優先する。

そのため本一覧は、

機能数を抑え

責務を単純化し

データの流れと遮断点を明確にする


ことを重視している。

10年先でも「何をしているか」が分かるEA——これが本機能一覧の最終目的である。


---

■ 全体設計思想

Tick駆動前提（1分足もティックの集約に過ぎない）

全機能は「失敗する前提」で設計

ログは後付けではなく制御構造の一部

判断は遅くていいが、遮断は即時

指標・戦略は玩具、制御と記録が本体



---

■ レイヤー構成

[Layer 0] Main Control（統括）  
   ↓  
[Layer 1] Safety Gate（即時遮断）  
   ↓  
[Layer 2] Observation（事実取得）  
   ↓  
[Layer 3] Decision（判断）  
   ↓  
[Layer 4] Execution（実行）  
   ↓  
[Layer 5] Logging（記録）  
   ↓  
[Base] Foundation（基盤）

※ 分析・研究はEA外部で行う前提
（EA内部に分析機能は極力持たせない）


---

═══════════════════════════

データフロー概要

═══════════════════════════

基本フロー（トレード実行）

市場データ → 基盤層 → 観測層 → 判断層 → 実行層 → 市場

詳細:

1. プラットフォームAPIから市場データ取得（基盤層）  
2. 経済指標・テクニカル指標を計算（観測層）  
3. シグナルを統合し判断層へ送信（観測層）  
4. 環境判定・取引判断（判断層）  
5. OCO注文発行・監視・決済（実行層）


---

フィードバックフロー（外部分析）

ログCSV → 外部ツール（MIA等） → レポート生成 → 人間が確認

詳細:

1. 取引結果・ログをCSVに記録（記録層）  
2. 外部ツールでデータ読込・統計計算  
3. 戦略別成績・時間帯別傾向を分析  
4. レポート生成・最適化提案  
5. 人間が承認後、設定ファイルを更新  
6. ホットリロードで新設定を反映（判断層）


---

監視フロー（ログ・エラー）

全層 → 記録層 → ログ出力・通知

詳細:

1. 各層が動作ログ・エラー情報を送信  
2. ログ収集・構造化（記録層）  
3. CSVファイルに出力（記録層）  
4. 重要なログは通知（記録層）  
5. 異常検知時はキルスイッチ発動


---

═══════════════════════════

【Layer 0】Main Control - 統括

═══════════════════════════

■ メイン制御機能

何をする: Tick受信を起点に、処理パイプラインを1回だけ回す

入力元: プラットフォーム（OnTick / OnTimer）

出力先: Safety Gate

備考:

ループ禁止

再入防止フラグ必須

ここでは判断しない

制御の起点




---

═══════════════════════════

【Layer 1】Safety Gate - 即時遮断

═══════════════════════════

全ての思考より先に動く存在。危険な状況では「何も考えさせない」ことを選ぶ。


---

■ 即時遮断（キルスイッチ）機能

何をする: 異常条件検知時に以降の全処理を即時中断

入力元: 基盤層（口座・接続・時間・戻り値）

出力先: Logging / Main Control（return）

備考:

スプレッド異常

証拠金不足

APIエラー

時刻ジャンプ

想定外Tick頻度

検知即中断




---

■ 処理健全性監視機能

何をする: Tick間隔・処理時間の異常を検知

入力元: 基盤層（時間管理機能）

出力先: キルスイッチ / ログ

備考:

フリーズ検知

遅延＝異常とみなす

処理時間監視




---

═══════════════════════════

【Layer 2】Observation - 観測

═══════════════════════════

市場の出来事を意味付けせずに事実として収集する。

シグナルの有効期限:
シグナルの有効期限は指標の性質により異なる。
イベント型（経済指標発表等）は即時、状態型（テクニカル指標等）は継続的に評価される。


---

■ 価格・時間観測機能

何をする: 価格・スプレッド・時間をそのまま取得

入力元: プラットフォームAPI

出力先: シグナル生成機能、判断層

備考:

加工しない

正規化は次段で行う

事実のみを取得




---

■ 経済指標監視機能

何をする: 経済指標カレンダーから次回発表イベントを取得し、発表時刻をカウントダウン

入力元: プラットフォームAPI（MT5）、外部CSVファイル

出力先: シグナル統合機能

備考:

重要度・国・変動幅でフィルタリング

MT4では経済指標エミュレーション機能経由

カウントダウン管理




---

■ テクニカル指標計算機能

何をする: 価格データからテクニカル指標を計算し、発火条件をチェック

入力元: 価格・時間観測機能

出力先: シグナル統合機能

備考:

プラグイン式（MACD、RSI、ボリンジャーバンド等）

各指標は独立したファイル

追加・削除が容易

トレンド系・オシレータ系

時間条件（NYクローズ等）

全て同一インターフェース




---

■ シグナル統合機能

何をする: 複数の指標結果をまとめて判断層へ渡す

入力元:

経済指標監視機能

テクニカル指標計算機能（複数）


出力先: 判断層（環境判定機能）

備考:

有効な指標のみを集める

MainEA内で実行

判断層への橋渡し役




---

═══════════════════════════

【Layer 3】Decision - 判断

═══════════════════════════


---

■ 環境判定機能

何をする: 複数シグナルから「今は何相場か」を判定

入力元: シグナル統合機能

出力先: 判断評価機能

備考:

トレンド / レンジ / 不明（＝何もしない）

指標の組み合わせで実現

環境認識は「結果的に」得られる

専用の環境認識指標も追加可能




---

■ 判断評価機能

何をする: 売買・静観・禁止のいずれかを決定

入力元:

環境判定結果

シグナル統合機能

外部設定読込機能（判断ルール）


出力先: 実行層（注文生成機能）

備考:

Yes / No / Block

ロット・価格は決めない

外部ルールファイルに従う

判断理由を記録




---

■ 外部設定読込機能

何をする: 外部ファイルから判断ルール・パラメータを読み込む

入力元: 外部設定ファイル

出力先: 判断評価機能

備考:

OnInit()時とホットリロード時に実行

再コンパイル不要で設定変更可能




---

■ ホットリロード機能

何をする: EA稼働中に外部ファイルの変更を検知し、再読込を行う

入力元: ファイルシステム（変更検知）

出力先: 外部設定読込機能

備考:

定期的にファイルをチェック

ポジション保有中は変更を破棄し、ログに警告

エラー時は前設定を維持

安全第一




---

═══════════════════════════

【Layer 4】Execution - 実行

═══════════════════════════


---

■ 注文生成機能

何をする: 判断結果を「現実の注文」に変換

入力元: 判断評価機能

出力先: プラットフォームAPI、ポジション管理機能

備考:

OCO前提（Buy Stop + Sell Stop等）

ロット計算はここ

リスクベース・ポジションサイジング

戻り値必須チェック




---

■ ポジション管理機能

何をする: 建玉の状態を追跡

入力元: 注文結果・価格

出力先: 追従管理機能、決済判断機能

備考:

1ポジション原則

状態遷移を明示

複数ポジションは持たない




---

■ 追従管理機能

何をする: SL/TPを条件に応じて更新

入力元: ポジション管理機能

出力先: プラットフォームAPI（注文変更）

備考:

トレーリングストップ

ブレークイーブン

変更理由を必ずログ化

ATRベースで動的調整可能




---

■ 決済判断機能

何をする: 決済条件（利確到達、損切到達等）をチェック

入力元:

ポジション管理機能

プラットフォームAPI（価格）


出力先: プラットフォームAPI（決済注文）

備考:

通常は利確/損切で自動決済

OCO監視機能と連携




---

═══════════════════════════

【Layer 5】Logging - 記録

═══════════════════════════


---

■ 構造化ログ機能（最重要）

何をする: 全判断・遮断・失敗を記録

入力元: 全レイヤー

出力先: CSV / 外部解析

備考:

判断理由

遮断理由

API戻り値

状態遷移

エスケープ処理（改行禁止、カンマ対応）

タイムスタンプ、レベル、層、機能名、メッセージ、詳細情報




---

■ 破壊点記録機能

何をする: 「ここで止めた」という地点を明示

入力元: キルスイッチ

出力先: ログ

備考:

後追い解析用

人間が必ず理解できる文言

デバッグの起点




---

■ 通知機能

何をする: 重要なログ（警告以上）をユーザに通知

入力元: 構造化ログ機能

出力先: プラットフォーム通知機能（Alert等）

備考:

エラー/致命的: 必ず通知

警告: オプション通知

本番環境のみ有効




---

═══════════════════════════

【Base】Foundation - 基盤

═══════════════════════════


---

■ プラットフォーム抽象化機能

何をする: MT4/MT5 API差異の隠蔽

入力元: プラットフォーム固有API（MT4/MT5）

出力先: 全ての上位層

備考:

EXMQL互換ライブラリ

注文・履歴・時間取得統一

時系列取得、ポジション管理を統一

上位層はプラットフォームを意識しない




---

■ 経済指標エミュレーション機能

何をする: MT4で経済指標を利用可能にする（MT5からデータ共有）

入力元: MT5の経済指標API

出力先: 経済指標監視機能（MT4環境）

備考:

MT5でカレンダー取得

FILE_COMMONで共有フォルダに保存

MT4が読み込む




---

■ 時間・状態管理機能

何をする: EAの現在状態を管理（待機/準備完了/注文待ち/ポジション保有等）

入力元: 各層からの状態変更通知

出力先: 各層（状態照会）

備考:

Tick時刻

EA状態

処理中フラグ

状態遷移を制御

不正な遷移を防ぐ




---

■ エラーハンドリング機能

何をする: システム全体のエラーを検知し、適切に処理

入力元: 全ての層（エラー発生箇所）

出力先: ログ収集機能、通知機能、キルスイッチ

備考:

GetLastError()でエラー取得

エラーコードごとに適切な対処

必要に応じて処理停止




---

■ 共通データ定義機能

何をする: 全層で使う共通のデータ形式を定義・提供

入力元: なし（定義のみ）

出力先: 全ての層

備考:

指標判断結果の形式

取引判断の形式

イベント記録データの形式

システム全体の共通語




---

═══════════════════════════

運用モード別の動作

═══════════════════════════

リアル/デモ口座

有効な機能:  
✅ 観測層（全て）  
✅ 判断層（全て）  
✅ 実行層（全て）  
✅ ログ収集・構造化・出力  
✅ 通知機能  
✅ 基盤層（全て）  
  
無効な機能:  
❌ EA内分析機能（外部ツールで実施）


---

テスターモード

有効な機能:  
✅ 観測層（全て）  
✅ 判断層（全て）  
✅ 実行層（全て・仮想実行）  
✅ ログ収集・構造化・出力  
✅ 基盤層（全て）  
  
無効な機能:  
❌ 通知機能（不要）  
❌ EA内分析機能（外部ツールで実施）


---

═══════════════════════════

補足情報

═══════════════════════════

イレギュラー処理の原則

システム的なトラブル（通信エラー、口座異常、スプレッド異常等）を検知した場合、
全ポジションを決済し、システムを終了する。

復旧より停止を優先する。


---

機能の独立性

観測層 ⊥ 判断層 ⊥ 実行層  
  
各層は下位層の出力のみを入力とし、  
上位層への逆参照を持たない。  
  
これにより:  
- テストが容易  
- 変更の影響が局所的  
- プラグイン追加が容易


---

プラグイン対応機能

✅ テクニカル指標  
✅ OCO注文パターン  
✅ 外部分析ツール  
  
追加手順:  
1. ファイル作成  
2. 統一インターフェースに従う  
3. 配置  
  
以上！システム変更不要


---

外部設定で変更可能な項目

✅ 判断ルール  
✅ 優先度  
✅ 利確/損切倍率  
✅ トレーリングパラメータ  
✅ 有効な指標の選択  
✅ フィルタ条件  
✅ 通知設定


---

═══════════════════════════

この設計が意図的に「持たないもの」

═══════════════════════════

内部最適化

機械学習

自動進化

高度分析

EA内部での統計計算


👉 それらは全て「EAの外」でやる
👉 MIA等の外部ツールで実施

理由:

EA本体は軽量・高速・安定を優先

分析は時間をかけて丁寧に

責務の分離



---

═══════════════════════════

最後に

═══════════════════════════

この機能一覧は、最も地味で、最も退屈で、最も長く生き残る設計である。

勝率はログから作ればいい。
戦略は玩具箱に入れておけばいい。

だが、

> 壊れた理由が分からないEAだけは作ってはいけない



それが、この一覧の唯一の主張である。


---

═══════════════════════════

備考

═══════════════════════════

本機能一覧について

作成日: 2025-12-13

作成者: Claude Sonnet 4.5

ベース: ChatGPT版

追加要素: Claude v1.4の詳細度、データフロー図、運用モード別動作

ステータス: 統合版（投票用）


統合方針

ChatGPT版の「壊れ方が分かるEA」という哲学をベースに、
Claude v1.4の詳細度（入出力先、備考欄）とデータフロー図を組み込んだ。

重視したこと:

シンプルさ（機能数を抑える）

実装可能性（矛盾のない設計）

保守性（10年先も分かる）

説明可能性（壊れた理由が分かる）


意図的に削ったもの:

EA内部の分析機能（外部ツールで実施）

過度な最適化機能

実装が困難な高度機能



---
