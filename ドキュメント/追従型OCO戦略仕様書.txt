
---

# 📘 追従型OCO戦略 仕様書（厳密版）

## （Aegis Strategy Specification – Trailing OCO）

---

## 1. 位置づけと前提

### 1.1 本仕様書の位置づけ

本仕様書は **Aegis における「一つの機能（戦略）」の定義**である。

* Aegis 本体の設計・思想を **一切変更しない**
* 追従型は **有効化されなければ存在しない**
* 他戦略（経済指標型、MACD 等）と**排他的ではない**

> **追従型は Aegis の主役ではない。
> Aegis が成立していることが前提で、初めて意味を持つ。**

---

### 1.2 用語定義（本仕様書内）

| 用語    | 意味                         |
| ----- | -------------------------- |
| ティック  | OnTick() により発生する単一イベント     |
| 初期OCO | 最初に配置される両建て注文              |
| 追従    | 未約定側の注文価格を価格変動に合わせて再配置すること |
| 残存側   | 一方が約定した後も残っている注文           |
| 無操作   | ティックを受け取ったが、何もしない判断        |

---

## 2. 基本思想（最重要）

### 2.1 追従型は「判断しない」

追従型戦略は以下を **行わない**：

* 市場予測
* トレンド判断
* 優位性の主張

追従型が行うのは、**次の一点のみ**。

> **「すでに与えられたルールに従って、注文位置を機械的に更新する」**

---

### 2.2 トリガーは常に「ティック」

* 時間イベントは使用しない
* 週末判定・薄商い判定も **ティック起点**
* ティックが来なければ、何も起きない

---

## 3. Aegis とのインターフェース

### 3.1 入力（Aegis → 追従型）

追従型は **Aegis から「判断材料の塊」を受け取る**。

#### 入力データ（概念）

```
StrategyContext
{
    現在価格（Bid / Ask）
    現在時刻
    曜日
    週末フラグ
    市場状態（Aegis判断結果）
    既存注文状態（Execution層より）
}
```

> 追従型は
> **「何が必要か」をAegisに要求しない**
> **「渡されたものだけを使う」**

---

### 3.2 出力（追従型 → Aegis）

追従型の返答は **必ず以下のいずれか**。

1. **無操作**
2. **注文更新（価格変更）**
3. **戦略終了（今週は終わり等）**

> 成否・理由・感情は返さない
> **結果のみ返す**

---

## 4. 初期OCO配置仕様

### 4.1 初期配置条件

* Aegis が「動作権限」を渡したときのみ実行
* すでに OCO が存在する場合は **配置しない**

### 4.2 初期配置内容

* Buy Stop × 1
* Sell Stop × 1
* 距離は **固定パラメータ**
* ロットサイズは **Aegis 側で決定済み**

---

## 5. 追従ロジック（核心）

### 5.1 追従の対象

* **未約定側の注文のみ**
* 約定済み側は一切触らない

---

### 5.2 追従条件

以下をすべて満たした場合のみ追従する：

1. 新しい理論価格が算出できる
2. 現在価格との差が **最小追従距離以上**
3. 既存注文価格より **有利方向**

---

### 5.3 追従処理

* 注文を **キャンセル → 再配置**
* 価格更新のみ（ロット・TP/SL 不変）
* 同一ティック内で **1回のみ**

---

## 6. 終了条件

追従型は **自ら終了を宣言できる**。

### 6.1 終了トリガー例

* 週末直前（戦略内判断）
* 追従回数上限到達
* 異常状態検知（Execution層より）

### 6.2 終了時の動作

* すべての残存注文をキャンセル
* Aegis に「終了」を返す
* 次ティック以降、呼ばれても **無操作**

---

## 7. ログ仕様（必須）

### 7.1 ログに残すもの

* 初期OCO配置理由
* 追従判断の有無
* 追従実行時の旧価格 / 新価格
* 追従しなかった理由（距離不足など）
* 終了理由

### 7.2 ログに残さないもの

* 感情的説明
* 推測
* 将来予測

---

## 8. 禁止事項（重要）

追従型は以下を **絶対に行ってはならない**：

* Aegis の判断を上書きする
* 他戦略の状態を参照する
* ロット・資金管理を変更する
* ティック以外で動作する

---

## 9. 拡張について

* 追従ロジックの変更は **派生戦略**として扱う
* 本仕様書は **最小構成の基準**
* 複雑化は本体ではなく「別仕様書」で行う

---

## 10. 最終原則（憲法条文）

> **追従型は、
> うまく動かなくてもよい。
> だが、なぜそう動いたかは
> 必ず説明できなければならない。**

---

## まとめ

* 本仕様は **実装に直結する**
* 曖昧な判断を排除している
* Claude / Genspark が **同じコード像を描ける**

---

